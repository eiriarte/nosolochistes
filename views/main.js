!function(){function e(e){if(y.classList.contains("visible")){var n=e.key||e.keyCode;27===n||"Escape"===n?t():9!=n&&"Tab"!==n||(e.shiftKey?document.activeElement===x&&(e.preventDefault(),E.focus()):document.activeElement===E&&(e.preventDefault(),x.focus()))}}function t(){y.classList.remove("visible"),b.classList.remove("visible"),S.focus()}function n(){C.select(),document.execCommand("copy")&&(k.setAttribute("aria-hidden","false"),k.setAttribute("role","alert"),k.classList.add("visible"),setTimeout(function(){k.classList.remove("visible"),k.setAttribute("aria-hidden","true"),k.removeAttribute("role")},2e3),ga("send",{hitType:"event",eventCategory:-1!==C.value.indexOf("/chiste/")?"Chiste":"Categoría",eventAction:"Copiar Enlace",eventLabel:C.value.split("/").pop()}))}function o(e){e.onclick||(e.onclick=function(){p(e);var t=e.dataset.cardId,n=document.querySelector(".share").getBoundingClientRect().top,o=document.getElementById(t),c=o.getBoundingClientRect().bottom+16,a=n-c,s=document.getElementById("share:"+t).querySelector("button");a<0&&window.scrollBy(0,-a),s.focus()})}function c(e){var t,n,o=e.parentElement.dataset.url||window.location.href,c=-1!==o.indexOf("/chiste/")?"Chiste":"Categoría",a=o.split("/").pop();o=o.split("?")[0]+"?"+I[e.title],o=A[e.title].replace("%url%",encodeURIComponent(o)),n=e.parentElement.classList.contains("share-item")?e.parentElement.parentElement.parentElement.querySelector(".text").textContent:e.parentElement.id?document.querySelector(".text").textContent:document.title,t=n,t.length>228&&(t=t.slice(0,225)+"[…]"),o=o.replace("%tw_text%",encodeURIComponent(t)),o=o.replace("%text%",encodeURIComponent(n)),window.open(o,"_blank"),ga("send",{hitType:"event",eventCategory:c,eventAction:"Compartir en "+e.title,eventLabel:a})}function a(e){var t,n=e.parentElement.dataset.url||window.location.href;S=document.activeElement||e,t=e.parentElement.classList.contains("share-item")?e.parentElement.parentElement.parentElement.querySelector(".title").textContent:document.title,w.textContent=t,C.value=n,y.classList.add("visible"),b.classList.add("visible"),E.focus()}function s(){h=JSON.parse(localStorage.getItem("fch-ups")||"[]"),g=JSON.parse(localStorage.getItem("fch-downs")||"[]")}function i(){localStorage.setItem("fch-ups",JSON.stringify(h)),localStorage.setItem("fch-downs",JSON.stringify(g))}function r(e,t){var n="vup"===e?h:g,o="vup"===e?g:h,c=o.indexOf(t);return-1!==c&&o.splice(c,1),n.push(t),i(),l(),-1!==c}function l(){h.forEach(u("vup","vdown")),g.forEach(u("vdown","vup"))}function u(e,t){return function(n){var o=document.getElementById(e+":"+n),c=document.getElementById(t+":"+n);o&&!o.classList.contains("pressed")&&(o.className+=" pressed",o.setAttribute("aria-pressed","true"),c.className=c.className.replace(" pressed",""),c.setAttribute("aria-pressed","false"))}}function d(){document.querySelectorAll(".btn.vote").forEach(function(e){e.onclick||(e.onclick=m)})}function m(){var e,t=this.id.split(":"),n=t[0],o="vup"===n?"vdown":"vup",c=t[1],a="/chiste/"+c+"/action",s=this;this.classList.contains("pressed")||(e=r(n,c),v(a,{action:n,reverse:e},function(e,t){var n=document.getElementById(o+":"+c);if(e)return console.error(e);s.querySelector(".nvotes").textContent=t.votes,n.querySelector(".nvotes").textContent=t.otherVotes}),ga("send",{hitType:"event",eventCategory:"Chiste",eventAction:"vup"===n?"Me Gusta":"No Me Gusta",eventLabel:c}))}function p(e){var t=document.getElementById(e.getAttribute("aria-controls"));"true"===e.getAttribute("aria-expanded")?(e.setAttribute("aria-expanded","false"),t.setAttribute("aria-expanded","false")):(e.setAttribute("aria-expanded","true"),t.setAttribute("aria-expanded","true"))}function f(){var e=document.querySelector(".cconsent");localStorage&&localStorage.getItem("duendes-cc")||v("https://d2pcbc801cuv3o.cloudfront.net/cconsent.json",function(t,n){n&&"europe"===n.location?(e.className+=" visible",document.querySelector(".cconsent .close").onclick=function(){e.className="cconsent",localStorage&&localStorage.setItem("duendes-cc","1")}):localStorage&&localStorage.setItem("duendes-cc","1")})}function v(e,t,n){var o=new XMLHttpRequest;n?(o.open("POST",e,!0),o.setRequestHeader("Content-Type","application/json; charset=UTF-8"),t=JSON.stringify(t)):(n=t,t=null,o.open("GET",e,!0)),o.onload=function(){if(o.status>=200&&o.status<400)try{var e=JSON.parse(o.responseText);n(null,e)}catch(e){n(e)}else n(o.status)},o.onerror=function(){n("NETWORK_ERROR")},o.send(t)}var h,g,y,b,E,S,w,C,x,k,A={Twitter:"https://twitter.com/intent/tweet?text=%tw_text%&url=%url%&via=feti_chistes&hashtags=chistes",Facebook:"https://www.facebook.com/sharer/sharer.php?u=%url%","Google+":"https://plus.google.com/share?url=%url%",WhatsApp:"https://api.whatsapp.com/send?text=%text%%20%url%"},I={Twitter:"utm_source=twitter&utm_medium=social&utm_campaign=fchtoolbar",Facebook:"utm_source=facebook&utm_medium=social&utm_campaign=fchtoolbar","Google+":"utm_source=gplus&utm_medium=social&utm_campaign=fchtoolbar",WhatsApp:"utm_source=whatsapp&utm_medium=social&utm_campaign=fchtoolbar"};document.addEventListener("DOMContentLoaded",function(){var i=document.getElementById("btn-menu");y=document.querySelector(".popup-bg"),b=document.querySelector(".popup"),E=document.querySelector(".btn-copy-link"),x=document.querySelector(".btn-close-copy"),k=document.querySelector(".msg-copied"),w=document.getElementById("link-title"),C=document.getElementById("link-input"),document.body.onkeydown=e,E.onclick=n,x.onclick=t,i.onclick=function(){p(i)},document.querySelectorAll(".btn.expand-share").forEach(o),document.querySelectorAll(".btn-social").forEach(function(e){e.onclick="Copiar enlace"===e.title?function(){a(e)}:function(){c(e)}}),s(),l(),d(),f()})}();