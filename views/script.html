<script>
!function(){function e(){h=JSON.parse(localStorage.getItem("fch-ups")||"[]"),g=JSON.parse(localStorage.getItem("fch-downs")||"[]")}function t(){localStorage.setItem("fch-ups",JSON.stringify(h)),localStorage.setItem("fch-downs",JSON.stringify(g))}function n(e,n){var r="vup"===e?h:g,a="vup"===e?g:h,c=a.indexOf(n);return-1!==c&&a.splice(c,1),r.push(n),t(),o(),-1!==c}function o(){h.forEach(r("vup","vdown")),g.forEach(r("vdown","vup"))}function r(e,t){return function(n){var o=document.getElementById(e+":"+n),r=document.getElementById(t+":"+n);o&&!o.classList.contains("pressed")&&(o.className+=" pressed",o.setAttribute("aria-pressed","true"),r.className=r.className.replace(" pressed",""),r.setAttribute("aria-pressed","false"))}}function a(){document.querySelectorAll(".btn.vote").forEach(function(e){e.onclick||(e.onclick=c)})}function c(){var e,t=this.id.split(":"),o=t[0],r="vup"===o?"vdown":"vup",a=t[1],c="/chiste/"+a+"/action",s=this;this.classList.contains("pressed")||(e=n(o,a),m(c,{action:o,reverse:e},function(e,t){var n=document.getElementById(r+":"+a);if(e)return console.error(e);s.querySelector(".nvotes").textContent=t.votes,n.querySelector(".nvotes").textContent=t.otherVotes}),ga("send",{hitType:"event",eventCategory:"Chiste",eventAction:"vup"===o?"Me Gusta":"No Me Gusta",eventLabel:a}))}function s(e){N=e,v&&(e?v.className+=" show":v.className=v.className.replace(" show",""))}function i(){var e,t=document.querySelectorAll("article").length;if(t<y)return b=!0,void s(!1);e=window.location.pathname+"?skip="+t,m(e,function(e,t){if(e)return b=!0,s(!1),void console.error(e);s(!1),u(t),t.length<20&&(b=!0)})}function u(e){var t,n;"object"==typeof e&&e.length&&(t=document.createElement("section"),n=document.querySelector("article"),e.forEach(function(e){t.appendChild(l(e,n))}),document.querySelector("main").insertBefore(t,v),o(),a(),S++,ga("send",{hitType:"event",eventCategory:"PÃ¡gina",eventAction:"avance",eventValue:S}))}function l(e,t){var n=t.cloneNode(!0),o=n.querySelector(".category a"),r=n.querySelector(".title a"),a=n.querySelector(".date"),c=n.querySelector(".btn.vote.up"),s=n.querySelector(".btn.vote.down");return n.querySelector(".name").textContent=e.autor,a.setAttribute("datetime",e.datetime),a.textContent=e.fecha,r&&(r.textContent=e.titulo,r.setAttribute("href","/chiste/"+e._id)),o&&(o.textContent=e.categoria.menu,o.setAttribute("href","/chistes/"+e.categoria._id)),f(n.querySelector(".text"),e.texto),d(c,"vup:"+e._id,e.ups),d(s,"vdown:"+e._id,e.downs),n}function d(e,t,n){e.id=t,e.className="btn vote",e.setAttribute("aria-pressed","false"),e.querySelector(".nvotes").textContent=n}function f(e,t){e.textContent="",t.split(/\r\n|\n/).forEach(function(t,n){n>0&&e.appendChild(document.createElement("br")),e.appendChild(document.createTextNode(t))})}function p(e,t){-1!==t.className.indexOf("toggled")?(t.className=t.className.replace(" toggled",""),e.setAttribute("aria-expanded","false"),t.setAttribute("aria-expanded","false")):(t.className+=" toggled",e.setAttribute("aria-expanded","true"),t.setAttribute("aria-expanded","true"))}function m(e,t,n){var o=new XMLHttpRequest;n?(o.open("POST",e,!0),o.setRequestHeader("Content-Type","application/json; charset=UTF-8"),t=JSON.stringify(t)):(n=t,t=null,o.open("GET",e,!0)),o.onload=function(){if(o.status>=200&&o.status<400)try{var e=JSON.parse(o.responseText);n(null,e)}catch(e){n(e)}else n(o.status)},o.onerror=function(){n("NETWORK_ERROR")},o.send(t)}var v,h,g,y=20,S=1,N=!1,b=!1;document.addEventListener("DOMContentLoaded",function(){var t=document.getElementById("btn-menu"),n=document.getElementById("nav-menu");v=document.querySelector(".loader"),t.onclick=function(){p(t,n)},window.onscroll=function(){b||N||window.pageYOffset<document.body.scrollHeight-window.innerHeight-200||(s(!0),i())},e(),o(),a()})}();
</script>
