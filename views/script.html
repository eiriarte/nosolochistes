<script>
!function(){function e(){g=JSON.parse(localStorage.getItem("fch-ups")||"[]"),h=JSON.parse(localStorage.getItem("fch-downs")||"[]")}function t(){localStorage.setItem("fch-ups",JSON.stringify(g)),localStorage.setItem("fch-downs",JSON.stringify(h))}function n(e,n){var c="vup"===e?g:h,a="vup"===e?h:g,r=a.indexOf(n);return-1!==r&&a.splice(r,1),c.push(n),t(),o(),-1!==r}function o(){g.forEach(c("vup","vdown")),h.forEach(c("vdown","vup"))}function c(e,t){return function(n){var o=document.getElementById(e+":"+n),c=document.getElementById(t+":"+n);o&&!o.classList.contains("pressed")&&(o.className+=" pressed",o.setAttribute("aria-pressed","true"),c.className=c.className.replace(" pressed",""),c.setAttribute("aria-pressed","false"))}}function a(){document.querySelectorAll(".btn.vote").forEach(function(e){e.onclick||(e.onclick=r)})}function r(){var e,t=this.id.split(":"),o=t[0],c="vup"===o?"vdown":"vup",a=t[1],r="/chiste/"+a+"/action",s=this;this.classList.contains("pressed")||(e=n(o,a),m(r,{action:o,reverse:e},function(e,t){var n=document.getElementById(c+":"+a);if(e)return console.error(e);s.querySelector(".nvotes").textContent=t.votes,n.querySelector(".nvotes").textContent=t.otherVotes}),ga("send",{hitType:"event",eventCategory:"Chiste",eventAction:"vup"===o?"Me Gusta":"No Me Gusta",eventLabel:a}))}function s(e){N=e,v&&(e?v.className+=" show":v.className=v.className.replace(" show",""))}function i(){var e,t=document.querySelectorAll("article").length;if(t<y)return b=!0,void s(!1);e=window.location.pathname+"?skip="+t,m(e,function(e,t){if(e)return b=!0,s(!1),void console.error(e);s(!1),u(t),t.length<20&&(b=!0)})}function u(e){var t,n;"object"==typeof e&&e.length&&(t=document.createElement("section"),n=document.querySelector("article"),e.forEach(function(e){t.appendChild(l(e,n))}),document.querySelector("main .lista").insertBefore(t,v),o(),a(),S++,ga("send",{hitType:"event",eventCategory:"PÃ¡gina",eventAction:"avance",eventValue:S}))}function l(e,t){var n=t.cloneNode(!0),o=n.querySelector(".category a"),c=n.querySelector(".title a"),a=n.querySelector(".date"),r=n.querySelector(".btn.vote.up"),s=n.querySelector(".btn.vote.down");return n.querySelector(".name").textContent=e.autor,a.setAttribute("datetime",e.datetime),a.textContent=e.fecha,c&&(c.textContent=e.titulo,c.setAttribute("href","/chiste/"+e._id)),o&&(o.textContent=e.categoria.menu,o.setAttribute("href","/chistes/"+e.categoria._id)),f(n.querySelector(".text"),e.texto),d(r,"vup:"+e._id,e.ups),d(s,"vdown:"+e._id,e.downs),n}function d(e,t,n){e.id=t,e.className="btn vote",e.setAttribute("aria-pressed","false"),e.querySelector(".nvotes").textContent=n}function f(e,t){e.textContent="",t.split(/\r\n|\n/).forEach(function(t,n){n>0&&e.appendChild(document.createElement("br")),e.appendChild(document.createTextNode(t))})}function p(e,t){-1!==t.className.indexOf("toggled")?(t.className=t.className.replace(" toggled",""),e.setAttribute("aria-expanded","false"),t.setAttribute("aria-expanded","false")):(t.className+=" toggled",e.setAttribute("aria-expanded","true"),t.setAttribute("aria-expanded","true"))}function m(e,t,n){var o=new XMLHttpRequest;n?(o.open("POST",e,!0),o.setRequestHeader("Content-Type","application/json; charset=UTF-8"),t=JSON.stringify(t)):(n=t,t=null,o.open("GET",e,!0)),o.onload=function(){if(o.status>=200&&o.status<400)try{var e=JSON.parse(o.responseText);n(null,e)}catch(e){n(e)}else n(o.status)},o.onerror=function(){n("NETWORK_ERROR")},o.send(t)}var v,g,h,y=20,S=1,N=!1,b=!1;document.addEventListener("DOMContentLoaded",function(){var t=document.querySelector(".cconsent"),n=document.getElementById("btn-menu"),c=document.getElementById("nav-menu");v=document.querySelector(".loader"),n.onclick=function(){p(n,c)},window.onscroll=function(){b||N||window.pageYOffset<document.body.scrollHeight-window.innerHeight-200||(s(!0),i())},e(),o(),a(),localStorage&&localStorage.getItem("duendes-cc")||m("https://d2pcbc801cuv3o.cloudfront.net/cconsent.json",function(e,n){n&&"europe"===n.location?(t.className+=" visible",document.querySelector(".cconsent .close").onclick=function(){t.className="cconsent",localStorage&&localStorage.setItem("duendes-cc","1")}):localStorage&&localStorage.setItem("duendes-cc","1")})})}();
</script>
